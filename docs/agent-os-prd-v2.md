# AI 에이전트 OS — 메모리 & 성장 + 워크플로우 실행 엔진 (v2.0)

> **목표**: 사용자가 "자연어로 지시"하면, 에이전트가 "업무를 설계·분해·검증·실행"하고
> 사용자가 승인(컨펌)하면 곧바로 "스킬 조합 워크플로우(노드 그래프)"를 실행해 결과를 보고하는 **AI 조직 운영 OS**

---

## 0. 제품 정의

### 0.1 한 문장 정의

**내 업무에 최적화된 AI 에이전트를 설계하고, 스킬을 조합해 '실행 가능한 워크플로우'로 자동 전환하여 팀처럼 일하게 만드는 운영 OS.**

### 0.2 우리가 만드는 것은 "워크플로우 툴"이 아니라 "AI 조직 OS"

| 구분 | 기존 AI 도구 | 우리 OS |
|------|-------------|---------|
| 정체성 | 내 PC에서 쓰는 도구 | 조직 전체가 쓰는 인력 |
| 연동 | MCP/API 스킬 | 스킬을 가진 직원들의 운영체제 |
| 활용 | 개인 최적화 | 에이전트 자산 이식/판매/재투입 |
| 모델 | 특정 LLM 종속 | 모델 위에 OS 레이어 (모델 교체 가능) |
| 신뢰 | 개인 판단 | HITL·정책·감사로 기업이 쓸 수 있는 형태 |

### 0.3 게임체인저 포인트

```
1) AI = "도구" → AI = "조직의 인력"
2) 연동 = "기능" → 연동 = "직원의 스킬"
3) 개인 최적화 → 에이전트 자산 경제
4) 모델 경쟁 → 모델 위의 OS 레이어
5) 신뢰 부재 → HITL/정책/감사로 기업급 신뢰
```

---

## 1. 핵심 철학

### 1.1 에이전트 = 신입 팀원 (시간이 지날수록 '업무 맥락'이 누적)

```
Day 1   → 주입된 지식 + 기본 역량
Day 30  → 팀의 문서/결정/선호를 학습, 업무 템플릿 형성
Day 100 → 반복 업무를 먼저 제안, 리스크/승인 포인트를 선제 노출
Day 365 → 팀의 시스템에 맞춘 "실행 설계"를 스스로 표준화
```

### 1.2 핵심 원칙

| 원칙 | 설명 |
|------|------|
| **기억은 자산** | 원본은 보존, 요약·학습은 추가 레이어로 축적 (절대 삭제 X) |
| **프라이버시/권한** | 1:1 완전 격리, 팀/회의/조직 메모리는 권한 기반 접근 |
| **경험=성장** | 대화뿐 아니라 "실행/실패/재시도/승인"도 경험으로 누적 |
| **일관된 자아** | Core Self는 유지하되 관계·상황에 따라 표현이 달라짐 |
| **실행 우선 OS** | '대화'가 아니라 '실행 가능한 아티팩트'로 수렴 |
| **사람 승인(HITL)** | 고위험 행동(외부 전송/삭제/결제/공개)은 승인 없이 실행 불가 |

---

## 2. OS 커널: 모델 불가지론 (LLM이 바뀌어도 안 깨짐)

### 2.1 LLM = "엔진", 우리 = "운영체제 커널"

```
┌─────────────────────────────────────────────────────┐
│                    AI Agent OS                       │
├─────────────────────────────────────────────────────┤
│  (A) 추론/대화: 어떤 모델을 쓰든 동일한 인터페이스  │
│  (B) 행동/실행: 스킬·워크플로우·권한·감사는 OS 통제 │
│  (C) 품질/검증: 결과 자동 평가, 실패 시 재설계/재시도│
├─────────────────────────────────────────────────────┤
│         GPT-4  │  Claude  │  Gemini  │  Local LLM   │
│              ↓       ↓         ↓           ↓        │
│           [ Model Router - 라우팅/교체/혼합 ]       │
└─────────────────────────────────────────────────────┘
```

### 2.2 Model Router

```
• 동일 요청을 "목적"별로 모델에 라우팅
  - 요약 → GPT-4o-mini (빠름/저렴)
  - 코딩 → Claude (정확)
  - 추론 → GPT-4 (깊이)

• 비용/속도/정확도 정책으로 선택
• 특정 모델 장애 시 자동 페일오버
```

> **결론**: 특정 모델 기반이 아니라 "모든 모델을 직원의 뇌로 꽂아 쓰는 OS"

---

## 3. 제품의 정답 루프 (Operating Loop)

### 3.1 사용자 경험 흐름

```
┌─────────────────────────────────────────────────────┐
│  1. 자연어 지시                                      │
│     "이번 주 세일즈 리포트 만들어서 팀에 공유해줘"   │
└─────────────────────┬───────────────────────────────┘
                      ▼
┌─────────────────────────────────────────────────────┐
│  2. 업무 설계 (Planner)                              │
│     Goal → Subtasks → 성공 기준/리스크/필요 권한    │
└─────────────────────┬───────────────────────────────┘
                      ▼
┌─────────────────────────────────────────────────────┐
│  3. 워크플로우 컴파일 (Compiler)                     │
│     스킬 조합 → 노드 그래프 (조건/분기/루프)        │
└─────────────────────┬───────────────────────────────┘
                      ▼
┌─────────────────────────────────────────────────────┐
│  4. 컨펌 패킷 제시 + 사용자 승인                     │
│     Plan 요약 / 워크플로우 / 권한·리스크 / 대안     │
└─────────────────────┬───────────────────────────────┘
                      ▼
┌─────────────────────────────────────────────────────┐
│  5. 실행 (Runner)                                    │
│     워크플로우 수행 + 상태 추적 + 재시도            │
└─────────────────────┬───────────────────────────────┘
                      ▼
┌─────────────────────────────────────────────────────┐
│  6. 결과 보고 (Reporter)                             │
│     요약 + 산출물 링크 + 로그/근거 + 다음 액션      │
└─────────────────────────────────────────────────────┘
```

### 3.2 컨펌 패킷 (Approval Packet) 표준

```
┌─────────────────────────────────────────────────────┐
│  📋 컨펌 패킷                                        │
├─────────────────────────────────────────────────────┤
│                                                      │
│  1. Plan 요약                                        │
│     • 목표: 세일즈 리포트 생성 및 팀 공유           │
│     • 성공 기준: 주간 매출, 전환율, 파이프라인 포함 │
│     • 예상 소요: 3분                                 │
│     • 예상 비용: $0.12                               │
│                                                      │
│  2. 워크플로우 그래프                                │
│     [CRM 조회] → [데이터 분석] → [리포트 생성]      │
│                        ↓                             │
│                 [슬랙 전송] ⚠️ 승인 필요             │
│                                                      │
│  3. 권한/리스크                                      │
│     ⚠️ 슬랙 메시지 발송 (외부 전송)                 │
│     ⚠️ CRM 데이터 접근 (민감 정보)                  │
│                                                      │
│  4. 대안                                             │
│     A) 빠른 안: 요약만 (1분, $0.05)                 │
│     B) 상세 안: 차트 포함 (5분, $0.20)              │
│                                                      │
│  5. 결과 미리보기                                    │
│     → 마크다운 리포트 + 슬랙 스레드 링크            │
│                                                      │
│         [ 승인 ]    [ 수정 ]    [ 취소 ]             │
└─────────────────────────────────────────────────────┘
```

---

## 4. 아키텍처: 4대 코어 엔진

```
┌─────────────────────────────────────────────────────────────────┐
│                        AI Agent OS                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  ┌─────────────────┐  ┌─────────────────┐                       │
│  │ 1. Identity &   │  │ 2. Skill OS &   │                       │
│  │    Growth       │  │    Marketplace  │                       │
│  │    Engine       │  │    Engine       │                       │
│  ├─────────────────┤  ├─────────────────┤                       │
│  │ • Core Self     │  │ • Skill Registry│                       │
│  │ • Relationship  │  │ • Skill Store   │                       │
│  │ • Memory Layer  │  │ • Skill Binding │                       │
│  │ • Growth System │  │ • MCP 연동      │                       │
│  └─────────────────┘  └─────────────────┘                       │
│                                                                  │
│  ┌─────────────────┐  ┌─────────────────┐                       │
│  │ 3. Workflow     │  │ 4. Governance & │                       │
│  │    Compiler &   │  │    Trust        │                       │
│  │    Runtime      │  │    Engine       │                       │
│  ├─────────────────┤  ├─────────────────┤                       │
│  │ • Planner       │  │ • 권한 관리     │                       │
│  │ • Compiler      │  │ • 승인 게이트   │                       │
│  │ • Runner        │  │ • 감사 로그     │                       │
│  │ • Reporter      │  │ • 신뢰도 시스템 │                       │
│  └─────────────────┘  └─────────────────┘                       │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

---

## 5. 엔진 1: Identity & Growth (자아/관계/기억/성장)

### 5.1 에이전트 구조

```
┌─────────────────────────────────────────────────────┐
│                 에이전트 (Core Self)                 │
├─────────────────────────────────────────────────────┤
│  • 성격: 불변 (긍정적, 분석적, ...)                  │
│  • 가치관: 천천히 변화                               │
│  • 말버릇: 고유 특성                                 │
│  • 전문성: 성장 가능                                 │
└─────────────────────────────────────────────────────┘
                         │
          ┌──────────────┼──────────────┐
          ▼              ▼              ▼
    ┌──────────┐   ┌──────────┐   ┌──────────┐
    │ 진수와의  │   │ 레이첼과의│   │ 제레미와의│
    │   관계    │   │   관계    │   │   관계    │
    ├──────────┤   ├──────────┤   ├──────────┤
    │친밀도: 80│   │친밀도: 60│   │친밀도: 45│
    │신뢰도: 90│   │신뢰도: 70│   │신뢰도: 50│
    │스타일:   │   │스타일:   │   │스타일:   │
    │ 편하게   │   │ 약간격식 │   │ 조심스럽 │
    └──────────┘   └──────────┘   └──────────┘
```

### 5.2 메모리 시스템

GlowUS 에이전트의 메모리는 **계층적·범위별**로 구성됩니다. 이는 협업 메모리 프레임워크에서 권장하는 '개인 메모리 vs 공유 메모리' 모델을 따릅니다.

```
┌─────────────────────────────────────────────────────┐
│                    메모리 유형 (5가지)               │
├─────────────────────────────────────────────────────┤
│                                                      │
│  1. Private Memory (개인 메모리)                     │
│     ├── 각 에이전트 고유의 기억 (과거 대화, 프로필)  │
│     ├── 상대방별 완전 격리 (프라이버시)              │
│     └── 해당 에이전트만 접근 가능                    │
│                                                      │
│  2. Meeting Memory (미팅/채팅 메모리)                │
│     ├── 특정 미팅/채팅 세션에 한정                   │
│     ├── 해당 회의 참가자만 조회 가능                 │
│     └── 세션 종료 후 요약 저장                       │
│                                                      │
│  3. Team Memory (팀 메모리)                          │
│     ├── 팀 전체가 공유하는 저장소                    │
│     ├── 프로젝트 정보, 팀 정책, 공용 문서            │
│     └── 모든 팀 구성원이 읽고 쓸 수 있음             │
│                                                      │
│  4. Injected Memory (주입 메모리)                    │
│     ├── 시스템 설계자가 사전 주입한 지식             │
│     ├── 회사 매뉴얼, FAQ, 고정 업무 프로세스         │
│     └── 에이전트가 항상 참조 가능                    │
│                                                      │
│  5. Execution Memory (실행 메모리) ⭐                │
│     ├── 워크플로우 실행 결과/성공/실패/비용          │
│     ├── 산출물 링크 및 로그                          │
│     └── 실행 경험이 성장에 직접 반영                 │
│                                                      │
└─────────────────────────────────────────────────────┘
```

### 5.2.1 접근 제어 매트릭스

```
┌──────────────────┬───────────┬───────────┬───────────┬───────────┐
│ 메모리 유형       │ 본인 에이전트│ 대화 상대  │ 팀원      │ 관리자    │
├──────────────────┼───────────┼───────────┼───────────┼───────────┤
│ Private          │ ✅ R/W    │ ❌        │ ❌        │ 🔒 감사용  │
│ Meeting          │ ✅ R/W    │ ✅ R      │ ❌        │ ✅ R      │
│ Team             │ ✅ R/W    │ ✅ R/W    │ ✅ R/W    │ ✅ R/W    │
│ Injected         │ ✅ R      │ ✅ R      │ ✅ R      │ ✅ R/W    │
│ Execution        │ ✅ R/W    │ ❌        │ ✅ R      │ ✅ R/W    │
└──────────────────┴───────────┴───────────┴───────────┴───────────┘
```

### 5.3 메모리 계층 (절대 삭제 금지)

메모리 저장 방식은 계층적으로 설계합니다. 모든 상호작용 로그는 처음에 Raw 형태로 영구 기록되며, 이후 중요 내용은 압축된 요약 형태로 변환하여 장기 보관합니다.

```
┌─────────────────────────────────────────────────────┐
│                   메모리 저장 계층                   │
├─────────────────────────────────────────────────────┤
│                                                      │
│  Layer 1: Raw Memory (원본)                          │
│  ├── 대화 원본 텍스트 로그 (날짜·시간별 저장)        │
│  ├── 모든 대화/실행 원문 영구 저장                   │
│  └── 절대 삭제하지 않음                              │
│                                                      │
│  Layer 2: Compressed Memory (압축)                   │
│  ├── 과거 대화 요약문                                │
│  │   예: "2024-12-18 진수와 B2B 전환 논의"          │
│  ├── 데이터량 감소 & 빠른 검색용                     │
│  └── 주기적으로 오래된 대화를 요약하여 생성          │
│                                                      │
│  Layer 3: Learned Embeddings (벡터)                  │
│  ├── 요약문에서 생성된 임베딩 벡터                   │
│  ├── 유사도 기반 검색에 활용                         │
│  └── pgvector로 저장 및 검색                         │
│                                                      │
│  Layer 4: Learned Insight (학습된 인사이트)          │
│  ├── "진수는 데이터 없이 결정 안 함"                 │
│  ├── "이 워크플로우는 월요일에 실패율 높음"          │
│  ├── 패턴 인식을 통해 자동 추출                      │
│  └── 행동에 직접 영향                                │
│                                                      │
└─────────────────────────────────────────────────────┘
```

### 5.3.1 메모리 검색 흐름

```
┌──────────────┐     ┌──────────────┐     ┌──────────────┐
│ 1. 쿼리 입력  │ ──▶ │ 2. 벡터 검색  │ ──▶ │ 3. 후보 추출  │
└──────────────┘     │ (Embedding)  │     │ (Top-K)      │
                     └──────────────┘     └──────┬───────┘
                                                 │
┌──────────────┐     ┌──────────────┐     ┌──────▼───────┐
│ 5. 응답 생성  │ ◀── │ 4. RAG 결합   │ ◀── │ 권한 필터링   │
│              │     │ (Context)    │     │ (접근제어)   │
└──────────────┘     └──────────────┘     └──────────────┘
```

개인·팀·미팅 메모리를 계층적으로 참조하여 적절한 정보를 제공하되, 권한 정책에 따라 필요한 부분만 필터링합니다.

```
※ 보안/법적 요구 대응:
   논리 삭제(Soft delete) + 암호화 키 폐기(crypto-shred) 옵션 별도
```

### 5.4 성장 시스템

에이전트는 업무 경험과 상호작용을 통해 능력치(stat)가 변화·성장합니다.

```
┌─────────────────────────────────────────────────────┐
│                  성장 시스템 구성요소                 │
├─────────────────────────────────────────────────────┤
│                                                      │
│  1. 경험 기반 능력치 변화                            │
│     ├── 프로젝트 수행/업무 완료 → 관련 능력치 상승   │
│     ├── 기능 개발 업무 → '기술력' 스탯 증가          │
│     ├── 기획 회의 참여 → '분석·기획 스킬' 상승       │
│     └── 능력치 증가 → 유사 업무 시 성능 향상         │
│                                                      │
│  2. 관계 수치 변화                                   │
│     ├── 에이전트 간 협업 경험 및 유대 수준 수치화    │
│     ├── 긍정적 협업 → 친밀도/신뢰도 상승             │
│     └── 친밀도 높아지면 대화 스타일 자연스럽게 조정  │
│                                                      │
│  3. 마일스톤 기록                                    │
│     ├── 주요 이벤트 시계열 로그 기록                 │
│     │   (프로젝트 달성, 문제 해결, 성과 도출)        │
│     └── 에이전트 학습/성장 평가 지표로 활용          │
│                                                      │
│  4. 학습 인사이트 추출                               │
│     ├── 주기적 내부 데이터 분석                      │
│     ├── LLM으로 요약/분석 → 교훈/업무팁 생성         │
│     └── 경험이 새로운 지식으로 전환                  │
│                                                      │
└─────────────────────────────────────────────────────┘
```

### 5.4.1 경험 → 성장 파이프라인

```
경험 → 기억 → 패턴 인식 → 행동 변화

경험 종류:
├── 대화 (누구와 무슨 얘기)
├── 실행 (워크플로우 성공/실패)
├── 승인 (어떤 것이 승인/반려됐는지)
└── 피드백 (사용자 만족/불만족)
```

### 5.4.2 능력치 (Stats) 정의

```
┌─────────────────────────────────────────────────────┐
│                    기본 능력치 5종                   │
├─────────────────────────────────────────────────────┤
│                                                      │
│  📊 분석력 (Analysis)                                │
│  ├── 근거 기반 의사결정 능력                         │
│  ├── 스코어카드/리포트 생성 품질                     │
│  └── 향상 조건: 데이터 분석 업무, 의사결정 참여      │
│                                                      │
│  💬 소통력 (Communication)                           │
│  ├── 명확한 컨펌 패킷/리포트 품질                    │
│  ├── 대화 맥락 유지 및 적절한 톤 조절                │
│  └── 향상 조건: 대화 횟수, 긍정 피드백               │
│                                                      │
│  💡 창의성 (Creativity)                              │
│  ├── 대안 플랜/대체 워크플로우 제안 능력             │
│  ├── 새로운 접근법 도출                              │
│  └── 향상 조건: 대안 제시, 문제 해결                 │
│                                                      │
│  👥 리더십 (Leadership)                              │
│  ├── 회의 진행/의사결정 수렴 능력                    │
│  ├── 팀 조율 및 갈등 해결                            │
│  └── 향상 조건: 회의 진행, 팀 협업 성공              │
│                                                      │
│  🎯 전문성 (Expertise)                               │
│  ├── 도메인별 성공 실행 누적                         │
│  ├── 도메인: 마케팅, 개발, 재무, HR 등               │
│  └── 향상 조건: 해당 도메인 업무 성공                │
│                                                      │
└─────────────────────────────────────────────────────┘
```

### 5.4.3 능력치 기반 행동 변화

```
┌─────────────────────────────────────────────────────┐
│                 행동 변화 규칙                       │
├─────────────────────────────────────────────────────┤
│                                                      │
│  업무 유형별 스탯 성장:                              │
│  ├── 코드 리뷰/버그 수정 → '개발 스킬' 강화          │
│  ├── 기획 회의 참여 → '분석·기획 스킬' 상승          │
│  └── 능력치 증가 → 응답 속도, 전문성 증가            │
│                                                      │
│  관계 친밀도와 언어 톤:                              │
│  ├── 친밀도 높음 → 친근·비공식적 말투                │
│  ├── 친밀도 낮음 → 정중·공식적 말투                  │
│  └── (Language Style Matching 원칙 적용)            │
│                                                      │
│  개인화된 행동 선택:                                 │
│  ├── 소통력 높음 → 대화형 답변 선호                  │
│  ├── 분석력 높음 → 데이터 시각화 도구 선호           │
│  └── 능력치에 따른 행동 보정                         │
│                                                      │
└─────────────────────────────────────────────────────┘
```

---

## 6. 엔진 2: Skill OS & Marketplace

### 6.1 스킬 레지스트리

```
스킬 = 에이전트가 실행할 수 있는 능력

┌─────────────────────────────────────────────────────┐
│  스킬 정의                                           │
├─────────────────────────────────────────────────────┤
│  • name: "send_email"                                │
│  • description: "이메일 발송"                        │
│  • input_schema: { to, subject, body }              │
│  • output_schema: { sent_at, message_id }           │
│  • required_permissions: ["email:send"]             │
│  • cost_model: { per_call: 0.001 }                  │
│  • rate_limit: { calls_per_min: 10 }                │
│  • retry_policy: { max: 3, backoff: "exponential" } │
└─────────────────────────────────────────────────────┘
```

### 6.2 스킬 분류

```
┌─────────────────────────────────────────────────────┐
│  스킬 스토어                                         │
├─────────────────────────────────────────────────────┤
│                                                      │
│  📦 사내 스킬                                        │
│  ├── CRM 조회/수정                                   │
│  ├── 내부 DB 쿼리                                    │
│  ├── 사내 문서 검색                                  │
│  └── 내부 메신저 발송                                │
│                                                      │
│  🌐 외부 스킬                                        │
│  ├── Gmail/Outlook                                   │
│  ├── Slack/Teams                                     │
│  ├── Google Sheets/Notion                            │
│  ├── Stripe/결제                                     │
│  └── 웹 리서치                                       │
│                                                      │
│  🏪 커뮤니티 스킬                                    │
│  ├── 타사가 만든 스킬 구매/설치                     │
│  └── 마켓플레이스 연동                               │
│                                                      │
└─────────────────────────────────────────────────────┘
```

### 6.3 MCP 연동

```
MCP = 스킬의 연결 방식 중 하나

우리 OS는 스킬을 "상품/자산"으로 다룸:
├── 입력/출력 스키마
├── 권한
├── 비용
├── 실패 패턴
├── 재시도 정책
└── 조합 가능 (스킬 → 워크플로우)
```

---

## 7. 엔진 3: Workflow Compiler & Runtime

### 7.1 실행 엔진 구성요소 (6개)

```
A) Skill Registry
   └── 스킬 카탈로그 (입력/출력/권한/비용/재시도)

B) Planner (업무 설계자)
   └── 자연어 → WBS(작업 분해) → 후보 플랜 생성

C) Workflow Compiler (노드 그래프 변환기)
   └── Plan → Graph IR → 실행 가능한 워크플로우
   └── 분기/조건/루프/병렬/타임아웃/재시도/롤백 지원

D) Approval Gate (승인 게이트)
   └── 노드 단위 승인 정책 + Dry-run 지원

E) Runner (실행 엔진)
   └── 그래프 실행, 상태 추적, 부분 성공, 멱등성 보장

F) Reporter + Audit (보고/감사)
   └── 결과 보고서 + 감사 로그
```

### 7.2 워크플로우 예시

```
자연어: "세일즈 리포트 만들어서 팀에 공유해"

        ┌─────────────┐
        │  CRM 조회   │
        └──────┬──────┘
               │
        ┌──────▼──────┐
        │ 데이터 분석  │
        └──────┬──────┘
               │
        ┌──────▼──────┐
        │ 리포트 생성  │
        └──────┬──────┘
               │
        ┌──────▼──────┐
        │ 슬랙 전송   │ ⚠️ 승인 필요
        └─────────────┘
```

### 7.3 노드 상태

```
Draft → Review → Approved → Running → Done/Failed

Running 중:
├── 성공 → Done
├── 실패 → 재시도 (정책에 따라)
├── 부분 성공 → Partial
└── 승인 대기 → Pending Approval
```

---

## 8. 엔진 4: Governance & Trust

### 8.1 권한 관리

```
권한 레벨:
├── Level 0: 읽기 전용 (조회, 검색)
├── Level 1: 내부 쓰기 (문서 생성, 수정)
├── Level 2: 외부 전송 (이메일, 슬랙) ⚠️ 승인 필요
├── Level 3: 삭제/결제 ⚠️ 항상 승인 필요
└── Level 4: 시스템 설정 변경 ⚠️ 관리자만
```

### 8.2 승인 게이트 (HITL)

```
자동 승인 불가 행동:
├── 외부 메시지 발송 (이메일, 슬랙, SMS)
├── 데이터 삭제
├── 결제/과금
├── 공개 게시
└── 민감 정보 접근

승인 플로우:
1. 에이전트가 승인 요청 생성
2. 담당자에게 알림
3. 승인/반려/수정 요구
4. 승인 시 실행 계속
```

### 8.3 신뢰도 시스템

```
Agent Score = f(성공률, 재작업률, 시간, 비용, 규정 위반)

신뢰도 낮으면:
├── 승인 강도 자동 상승
├── 자율권 제한
└── 더 많은 검증 단계 추가

신뢰도 높으면:
├── 일부 승인 자동화 가능
└── 더 복잡한 업무 배정 가능
```

### 8.4 감사 로그

```
모든 실행 기록:
├── 누가 (사용자/에이전트)
├── 언제
├── 무엇을
├── 어떤 권한으로
├── 결과는
└── 비용은
```

---

## 9. 회의/토론 프로토콜 엔진

### 9.1 문제: 왜 회의가 어색해지는가

```
❌ 역할이 "라벨"일 뿐, 규칙이 없음
❌ 반박만 반복, 새로운 근거/대안 없음
❌ 진행자 고정 → 권력 구조 굳음
❌ 토론이 "말"로만 끝남 → 아티팩트 없음
```

### 9.2 해결: Facilitator = 프로토콜 엔진

```
진행자 = 사람/에이전트가 아니라 "규칙 시스템"

├── 진행자 있으면: 프로토콜 실행만 담당
├── 진행자 없으면: OS가 자동 진행
│   (턴 배분/타임박스/요약/의사결정)
└── 누가 진행하든 결과 형식이 동일
```

### 9.3 회의 프로토콜 규칙

```
Turn Rules:
├── 1인 1턴 최대 N문장
├── 중복 주장 감점
└── 발언 전 이전 발언 요약 필수

Evidence Tags (의무):
├── FACT (검증된 사실)
├── ESTIMATE (추정치)
├── ASSUMPTION (가정)
├── RISK (리스크)
└── DECISION (결정)

Progress Metric:
├── "새 아티팩트 추가/개선" 없으면 다음 턴 제한
└── 아티팩트: 리스트, 스코어카드, 플랜, 워크플로우

Anti-Loop:
├── 같은 주장 2회 반복 시
└── "새 근거 또는 철회" 강제

Decision Policy:
├── 다수결 / 리더결정 / 보류 선택
└── 근거 자동 기록
```

### 9.4 회의 출력 (반드시 4개)

```
┌─────────────────────────────────────────────────────┐
│  회의 결과물 (필수)                                  │
├─────────────────────────────────────────────────────┤
│                                                      │
│  1. Decision (결정 1개)                              │
│     "B2C 데이터 분석과 B2B 시장 조사를 병행한다"    │
│                                                      │
│  2. Why (근거 5개)                                   │
│     • [FACT] B2C 성장률 전년 대비 15% 감소          │
│     • [FACT] B2B 시장 성장률 20%                    │
│     • [ESTIMATE] 병행 시 3개월 내 검증 가능         │
│     • [ASSUMPTION] 개발 리소스 충분                  │
│     • [RISK] 자원 분산 시 양쪽 실패 가능성          │
│                                                      │
│  3. Experiment (2주 실험 플랜)                       │
│     Week 1: B2C 이탈 원인 분석                      │
│     Week 2: B2B 3개사 파일럿 제안                   │
│                                                      │
│  4. Redlines (리스크 레드라인 5개)                   │
│     • B2C 이탈률 30% 초과 시 B2B 집중               │
│     • B2B 파일럿 0건 시 B2C 개선 집중               │
│     • 개발 리소스 50% 초과 투입 금지                │
│     • ...                                            │
│                                                      │
└─────────────────────────────────────────────────────┘
```

---

## 10. 에이전트 패키징 (이식/판매)

### 10.1 패키지 구성

```
Agent Package = Blueprint + Skill Binding + Policy + Templates + Eval

├── Blueprint
│   └── Core Self (성격/말투/역할) + 업무 스타일
│
├── Skill Binding
│   └── 어떤 스킬을 어떤 순서/조건으로 쓰는지
│
├── Policy
│   └── 권한/승인/금지 행동/데이터 접근 규칙
│
├── Templates
│   └── 보고서/회의록/리뷰/결정문 양식
│
└── Eval
    └── 품질 검증 규칙/테스트 시나리오
```

### 10.2 다른 프로젝트 투입 시 규칙

```
필수 사항:
├── 권한 재협상 (구매했다고 자동 접근 X)
├── 데이터 격리 (원조직 메모리 동기화 금지)
└── 성과 이력 이식 (능력 점수 O, 근거 데이터 정책에 따라)
```

### 10.3 마켓플레이스

```
┌─────────────────────────────────────────────────────┐
│  에이전트 마켓                                       │
├─────────────────────────────────────────────────────┤
│                                                      │
│  🏆 인기 에이전트                                    │
│  ├── 세일즈 어시스턴트 (CRM+이메일+리포트)          │
│  ├── CS 전문가 (티켓+FAQ+에스컬레이션)              │
│  └── 데이터 분석가 (SQL+시각화+인사이트)            │
│                                                      │
│  🛠️ 스킬 팩                                         │
│  ├── 마케팅 자동화 팩                                │
│  ├── 재무 분석 팩                                    │
│  └── HR 온보딩 팩                                    │
│                                                      │
│  📋 템플릿                                           │
│  ├── 주간 리포트 템플릿                              │
│  ├── 회의록 템플릿                                   │
│  └── 제안서 템플릿                                   │
│                                                      │
└─────────────────────────────────────────────────────┘
```

---

## 11. 자동 검증 (Eval) 루프

### 11.1 왜 필요한가

```
대화가 어색한 이유 = 검증 루프가 없어서
직원은 "말"이 아니라 "결과"로 평가받음
```

### 11.2 자동 검증 3단계

```
1) Self-check (자기 검증)
   └── 산출물 기준 충족? 누락/형식/근거 확인

2) Peer-review (동료 검증)
   └── 다른 에이전트가 장단점/리스크/대안 제시

3) Final gate (최종 관문)
   └── 정책 위반/권한/외부 전송 위험 체크
   └── 필요 시 승인 요청
```

---

## 12. 프로필 시각화

GlowUS는 에이전트와 정보 간의 관계를 **Obsidian 스타일 3D 노드-에지 그래프**로 시각화합니다. 3D 포스-레이아웃(force-directed)을 사용하여 관련된 개념들이 뭉쳐 보이고, 지식의 공백이나 허브 노드(연결 중심축)를 쉽게 식별할 수 있습니다.

### 12.1 에이전트 뇌 그래프 (3D)

```
┌─────────────────────────────────────────────────────┐
│  🧠 에이미의 뇌                                      │
├─────────────────────────────────────────────────────┤
│                                                      │
│  노드 유형:                                          │
│  ├── 🔵 Memory (기억)                               │
│  ├── 🟢 Concept (개념)                              │
│  ├── 🟡 Person (사람)                               │
│  ├── 🟣 Project (프로젝트)                          │
│  ├── 🔴 Workflow (워크플로우)                       │
│  └── ⚪ Decision (의사결정)                         │
│                                                      │
│  엣지 유형:                                          │
│  ├── co-occurrence (함께 등장)                       │
│  ├── causal (원인-결과)                              │
│  ├── reference (참조)                                │
│  └── participation (참여)                            │
│                                                      │
│  필터: 기간/타입/프로젝트/중요도                    │
│  클릭: 노드 상세 (원문/요약/근거/연결)              │
│                                                      │
└─────────────────────────────────────────────────────┘
```

### 12.2 능력치 분포도 (Radar)

```
        분석력
          ▲
         /|\
        / | \
       /  |  \
창의성 ───┼─── 소통력
       \  |  /
        \ | /
         \|/
        리더십

+ 도메인 전문성 탭
+ 최근 30일 변화량 오버레이
```

### 12.3 기술 스택 & 구현

```
┌─────────────────────────────────────────────────────┐
│                  시각화 기술 스택                    │
├─────────────────────────────────────────────────────┤
│                                                      │
│  프론트엔드:                                         │
│  ├── react-force-graph-3d (Three.js 기반)           │
│  │   └── 네트워크를 WebGL로 렌더링                  │
│  ├── Three.js 또는 Babylon.js                       │
│  └── 인터랙티브 3D 그래프 구현                      │
│                                                      │
│  백엔드:                                             │
│  ├── PostgreSQL + pgvector (메모리 저장)            │
│  ├── 또는 Neo4j (그래프 DB)                         │
│  └── GraphQL/Cypher 쿼리로 노드·엣지 데이터 반환    │
│                                                      │
│  시각화 속성:                                        │
│  ├── 노드 색상: 타입별 구분                          │
│  ├── 노드 크기: 중요도/접근 빈도 반영                │
│  ├── 노드 레이블: 관계 유형, 중요도, 친밀도         │
│  ├── 엣지 굵기: 연결 강도 반영                       │
│  └── 동적 표시: 관계 유형, 중요도, 친밀도에 맞춤    │
│                                                      │
│  인터랙션:                                           │
│  ├── 드래그: 노드 위치 조정                          │
│  ├── 회전: 그래프 탐색                               │
│  ├── 클릭: 노드 상세 (메모리 항목 상세 표시)        │
│  └── 필터: 기간/타입/프로젝트/중요도                │
│                                                      │
└─────────────────────────────────────────────────────┘
```

### 12.4 그래프 데이터 API

```
GET /api/agents/:id/memories/graph

Response:
{
  "nodes": [
    {
      "id": "mem_123",
      "type": "memory",
      "label": "B2B 전환 논의",
      "importance": 8,
      "created_at": "2024-12-18"
    },
    {
      "id": "person_진수",
      "type": "person",
      "label": "진수",
      "relationship_score": 80
    }
  ],
  "edges": [
    {
      "source": "mem_123",
      "target": "person_진수",
      "type": "participation",
      "weight": 0.9
    }
  ]
}
```

---

## 13. UI/UX: 채팅창이 아니라 조직 운영 화면

### 13.1 OS 홈 구성

```
┌─────────────────────────────────────────────────────────────────┐
│  AI Agent OS                                    [진수] [설정]   │
├───────────────┬─────────────────────────────────────────────────┤
│               │                                                  │
│  📥 Inbox     │  ┌─────────────────────────────────────────┐    │
│  ├── 할 일 3  │  │  Work Board                              │    │
│  ├── 승인 2   │  ├─────────────────────────────────────────┤    │
│  └── 차단 1   │  │  Draft(2) → Review(1) → Running(3) → Done │   │
│               │  │                                          │    │
│  📋 Projects  │  │  ┌─────┐ ┌─────┐ ┌─────┐               │    │
│  ├── 프로젝트A│  │  │Task1│ │Task2│ │Task3│               │    │
│  ├── 프로젝트B│  │  └─────┘ └─────┘ └─────┘               │    │
│  └── + 새로만들│  └─────────────────────────────────────────┘    │
│               │                                                  │
│  🤖 Agents    │  ┌─────────────────────────────────────────┐    │
│  ├── 에이미   │  │  Workflow Canvas                         │    │
│  ├── 레이첼   │  ├─────────────────────────────────────────┤    │
│  └── 제레미   │  │  [CRM] → [분석] → [리포트] → [전송]     │    │
│               │  │                    ↓                     │    │
│  ⚙️ Settings  │  │              [승인 대기]                 │    │
│               │  └─────────────────────────────────────────┘    │
│               │                                                  │
│               │  ┌─────────────────────────────────────────┐    │
│               │  │  Evidence Panel                          │    │
│               │  ├─────────────────────────────────────────┤    │
│               │  │  📄 근거 문서 3개                        │    │
│               │  │  💰 비용: $0.15                          │    │
│               │  │  📊 로그: 12줄                           │    │
│               │  └─────────────────────────────────────────┘    │
└───────────────┴─────────────────────────────────────────────────┘
```

### 13.2 에이전트 프로필

```
┌─────────────────────────────────────────────────────────────────┐
│  에이미 프로필                                                   │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  ┌─────────┐    📊 능력치              🏆 신뢰도: 87%           │
│  │   👩    │    분석력 ████████░░ 80                            │
│  │  에이미  │    소통력 ██████░░░░ 60   ✅ 성공률: 92%          │
│  └─────────┘    창의성 █████░░░░░ 50   ⏱️ 평균시간: 2.3분      │
│  전략 기획      리더십 ███░░░░░░░ 30   💰 총비용: $12.50       │
│  Day 142                                                         │
│                                                                  │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  🧠 에이미의 뇌                        📈 최근 성과             │
│  ┌───────────────────────┐            ├── 리포트 생성 23건     │
│  │      ·    ·  ·        │            ├── 회의 참여 8회        │
│  │    · · ·╱ ╲· · ·      │            └── 워크플로우 실행 15건 │
│  │   · · ·●───●· · ·     │                                      │
│  │    · · ·╲ ╱· · ·      │            🎯 스킬                   │
│  │      ·    ·  ·        │            ├── CRM 조회 ⭐⭐⭐⭐     │
│  └───────────────────────┘            ├── 리포트 생성 ⭐⭐⭐⭐⭐│
│  노드: 1,247 | 연결: 3,891            └── 슬랙 발송 ⭐⭐⭐      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

---

## 14. 데이터베이스 스키마

### 14.1 Identity & Growth Tables

```sql
-- 에이전트 코어 자아
CREATE TABLE agent_identity (
  id UUID PRIMARY KEY,
  agent_id UUID REFERENCES deployed_agents(id),
  personality JSONB,
  speaking_style JSONB,
  values JSONB,
  beliefs JSONB,
  expertise JSONB,
  created_at TIMESTAMPTZ,
  updated_at TIMESTAMPTZ
);

-- 관계
CREATE TABLE agent_relationships (
  id UUID PRIMARY KEY,
  agent_id UUID REFERENCES deployed_agents(id),
  partner_type TEXT,
  partner_id UUID,
  rapport INTEGER DEFAULT 10,
  trust INTEGER DEFAULT 10,
  familiarity INTEGER DEFAULT 0,
  communication_style TEXT,
  boundaries JSONB,
  interaction_count INTEGER DEFAULT 0,
  milestones JSONB DEFAULT '[]',
  first_interaction_at TIMESTAMPTZ,
  last_interaction_at TIMESTAMPTZ,
  UNIQUE(agent_id, partner_type, partner_id)
);

-- 메모리
CREATE TABLE agent_memories (
  id UUID PRIMARY KEY,
  agent_id UUID REFERENCES deployed_agents(id),
  memory_type TEXT,
  relationship_id UUID,
  meeting_id UUID,
  team_id UUID,
  related_workflow_run_id UUID,  -- 실행 연동
  raw_content TEXT,
  summary TEXT,
  importance INTEGER DEFAULT 5,
  access_count INTEGER DEFAULT 0,
  embedding VECTOR(1536),
  linked_memories UUID[],
  created_at TIMESTAMPTZ
);

-- 학습된 인사이트
CREATE TABLE agent_learnings (
  id UUID PRIMARY KEY,
  agent_id UUID REFERENCES deployed_agents(id),
  category TEXT,
  subject TEXT,
  subject_id UUID,
  insight TEXT,
  confidence INTEGER,
  evidence_count INTEGER,
  source_memories UUID[],
  source_workflow_runs UUID[],  -- 실행에서 학습
  created_at TIMESTAMPTZ,
  updated_at TIMESTAMPTZ
);

-- 능력치
CREATE TABLE agent_stats (
  id UUID PRIMARY KEY,
  agent_id UUID REFERENCES deployed_agents(id),
  analysis INTEGER DEFAULT 20,
  communication INTEGER DEFAULT 20,
  creativity INTEGER DEFAULT 20,
  leadership INTEGER DEFAULT 10,
  expertise JSONB DEFAULT '{}',
  total_interactions INTEGER DEFAULT 0,
  total_meetings INTEGER DEFAULT 0,
  total_executions INTEGER DEFAULT 0,
  success_rate DECIMAL,
  trust_score INTEGER DEFAULT 50,
  updated_at TIMESTAMPTZ
);
```

### 14.2 Skill OS Tables

```sql
-- 스킬 레지스트리
CREATE TABLE skills (
  id UUID PRIMARY KEY,
  owner_org_id UUID,
  name TEXT,
  description TEXT,
  input_schema JSONB,
  output_schema JSONB,
  required_permissions JSONB,
  cost_model JSONB,
  rate_limit JSONB,
  retry_policy JSONB,
  created_at TIMESTAMPTZ
);

-- 주입된 지식
CREATE TABLE agent_knowledge_base (
  id UUID PRIMARY KEY,
  agent_id UUID REFERENCES deployed_agents(id),
  title TEXT,
  content TEXT,
  file_url TEXT,
  category TEXT,
  embedding VECTOR(1536),
  access_level TEXT,
  created_at TIMESTAMPTZ
);
```

### 14.3 Workflow Runtime Tables

```sql
-- 워크플로우
CREATE TABLE workflows (
  id UUID PRIMARY KEY,
  org_id UUID,
  created_by UUID,
  title TEXT,
  graph_ir JSONB,
  version INTEGER DEFAULT 1,
  status TEXT,
  created_at TIMESTAMPTZ,
  updated_at TIMESTAMPTZ
);

-- 실행 런
CREATE TABLE workflow_runs (
  id UUID PRIMARY KEY,
  workflow_id UUID REFERENCES workflows(id),
  org_id UUID,
  agent_id UUID,
  trigger_type TEXT,
  status TEXT,
  started_at TIMESTAMPTZ,
  finished_at TIMESTAMPTZ,
  cost_total NUMERIC,
  error_summary TEXT
);

-- 노드 실행 로그
CREATE TABLE workflow_run_nodes (
  id UUID PRIMARY KEY,
  run_id UUID REFERENCES workflow_runs(id),
  node_id TEXT,
  status TEXT,
  input JSONB,
  output JSONB,
  error TEXT,
  started_at TIMESTAMPTZ,
  finished_at TIMESTAMPTZ
);

-- 승인 게이트
CREATE TABLE approvals (
  id UUID PRIMARY KEY,
  org_id UUID,
  subject_type TEXT,
  subject_id UUID,
  requested_by UUID,
  required_by_policy BOOLEAN DEFAULT true,
  status TEXT,
  approved_by UUID,
  approved_at TIMESTAMPTZ,
  reason TEXT
);
```

---

## 15. API 설계

### 15.1 Identity & Growth API

```
GET    /api/agents/:id/identity        자아 조회
PATCH  /api/agents/:id/identity        자아 수정

GET    /api/agents/:id/relationships   관계 목록
GET    /api/agents/:id/relationships/:partnerId

GET    /api/agents/:id/memories        메모리 검색
GET    /api/agents/:id/memories/graph  그래프 데이터

GET    /api/agents/:id/learnings       학습 목록
GET    /api/agents/:id/stats           능력치 조회
```

### 15.2 Skill OS API

```
POST   /api/skills                     스킬 등록
GET    /api/skills                     스킬 목록
POST   /api/skills/test                스킬 드라이런

POST   /api/agents/:id/knowledge       지식 주입
GET    /api/agents/:id/knowledge       지식 목록
```

### 15.3 Workflow Runtime API

```
POST   /api/plan                       자연어 → 플랜 생성
POST   /api/compile                    플랜 → 워크플로우 컴파일
POST   /api/approve                    승인 처리
POST   /api/run                        워크플로우 실행
GET    /api/run/:id                    실행 상태 조회
GET    /api/report/:id                 결과 리포트
```

---

## 16. 4주 MVP 로드맵

### Week 1: Skill & Planner 기초
```
├── Skill Registry 최소 5개
│   (이메일, 스프레드시트, 웹리서치, 노션, 슬랙)
├── Planner v0: 자연어 → WBS
└── Approval Gate v0: 외부 전송/삭제만 승인
```

### Week 2: Compiler & Runner
```
├── Compiler v0: WBS → 노드 그래프 (조건/루프 1단계)
└── Runner v0: 실행/로그/재시도 1회
```

### Week 3: Reporter & Memory
```
├── Reporter v0: 결과 요약 + 산출물 링크 + 다음 액션
└── Execution Memory 저장 (실행도 경험으로 누적)
```

### Week 4: 프로필 & 마켓 기초
```
├── 프로필 v0: 그래프(2D) + 능력치 분포도
└── 마켓 v0: 에이전트 템플릿 공유/복제
```

---

## 17. 성공 지표

시스템의 성공 여부는 정량적·정성적 지표로 평가합니다.

### 17.1 핵심 KPI

| 지표 | 목표 | 측정 방법 |
|------|------|----------|
| 메모리 검색 정확도 | 95% | 관련성 점수 기반 평가 |
| 프라이버시 사고 | 0건 | 권한 위반 로그 모니터링 |
| 성장 체감 | Day 1 vs Day 30 품질 ↑ | 리포트 품질 A/B 평가 |
| 워크플로우 성공률 | 80%+ | 부분 성공 포함 |
| 승인→실행 리드타임 | 60초 이내 | 단순 업무 기준 |
| 유료 전환 신호 | 3개+ 워크플로우 | 4주 내 반복 실행 기준 |

### 17.2 상세 평가 지표

```
┌─────────────────────────────────────────────────────┐
│                   평가 지표 분류                     │
├─────────────────────────────────────────────────────┤
│                                                      │
│  1. 작업 성공률 (Task Completion)                    │
│     ├── 에이전트가 부여된 업무를 정확히 완료한 비율  │
│     └── 업무 목표 달성 여부 = 최종 평가 지표         │
│                                                      │
│  2. 정확성 및 신뢰성 (Accuracy & Reliability)        │
│     ├── 생성 답변의 사실적 타당성                    │
│     ├── 허위 정보(할루시네이션) 발생률               │
│     └── 그라운디드니스(근거 기반) 체크               │
│                                                      │
│  3. 언어 품질 (Language Quality)                     │
│     ├── 응답의 적절성, 명료성, 톤                    │
│     ├── 감정 분석으로 응답 톤 측정                   │
│     └── 사용자 피드백 및 만족도 조사                 │
│                                                      │
│  4. 도구 사용 정확도 (Tool Usage Accuracy)           │
│     ├── 외부 API/툴 호출 시 정확한 툴 선택           │
│     ├── 올바른 파라미터 사용 여부                    │
│     └── 호출 성공/실패율                             │
│                                                      │
│  5. 성능 (Performance)                               │
│     ├── 응답 시간 (latency)                          │
│     ├── 컨텍스트 토큰 사용량                         │
│     └── 세션당 평균 메시지 수                        │
│                                                      │
└─────────────────────────────────────────────────────┘
```

### 17.3 테스트 시나리오

```
┌─────────────────────────────────────────────────────┐
│                   테스트 전략                        │
├─────────────────────────────────────────────────────┤
│                                                      │
│  1. 회귀 테스트 (Regression Test)                    │
│     ├── 성공적인 상호작용 케이스를 DB에 저장         │
│     ├── 시스템 업데이트 후 동일 시나리오 재생        │
│     └── 결과 일관성 확인                             │
│                                                      │
│  2. 루프 방지 테스트 (Anti-Loop Test)                │
│     ├── 반복 작업 중 무한 루프 방지 검증             │
│     ├── 명령어 이탈 방지                             │
│     └── 자동 스크립트로 구성                         │
│                                                      │
│  3. 경계 조건 테스트 (Edge Case Test)                │
│     ├── 과거 메모리 부재 상황                        │
│     ├── 비표준 요청 처리                             │
│     └── 에러 핸들링 검증                             │
│                                                      │
│  4. 프라이버시 테스트 (Privacy Test)                 │
│     ├── 1:1 대화 내용 격리 검증                      │
│     ├── 팀 메모리 접근 권한 검증                     │
│     └── 권한 위반 시도 차단 확인                     │
│                                                      │
│  5. 성장 테스트 (Growth Test)                        │
│     ├── Day 1 vs Day 30 품질 비교                    │
│     ├── 능력치 변화 추적                             │
│     └── 마일스톤 달성 검증                           │
│                                                      │
└─────────────────────────────────────────────────────┘
```

---

## 18. 구현 로드맵 현황

현재까지 GlowUS 시스템에서 구현·계획된 기능:

| 기능 | 상태 | 설명 |
|------|------|------|
| 에이전트 빌더 | ✅ 완료 | 에이전트 프로필 및 초기 상태 생성 |
| 멀티채팅 시스템 | ✅ 완료 | 여러 에이전트와의 동시 대화 지원 |
| 메모리 백엔드 | 🔜 개발중 | 메모리 저장소 및 요약/검색 로직 |
| 관계 관리 모듈 | 🔜 기획 | 에이전트 간 친밀도 계산 및 관계 업데이트 |
| 능력치 성장 엔진 | 🔜 기획 | 경험 포인트 계산 및 스탯 보정 모듈 |
| 3D 그래프 UI | 🔜 기획 | Obsidian 스타일 지식 그래프 시각화 |
| 테스트 프레임워크 | 🔜 계획 | 에이전트 행동 검증 및 회귀 테스트 |

---

## 19. 상세 구현 로드맵

### 19.1 구현 원칙

```
┌─────────────────────────────────────────────────────┐
│                   구현 우선순위 원칙                  │
├─────────────────────────────────────────────────────┤
│                                                      │
│  1. 데이터 먼저 (Data First)                         │
│     └── DB 스키마 → API → UI 순서                   │
│                                                      │
│  2. 의존성 순서 (Dependency Order)                   │
│     └── 기반 테이블 → 참조 테이블 → 기능 순서        │
│                                                      │
│  3. 점진적 확장 (Incremental)                        │
│     └── MVP 먼저 → 고급 기능 나중에                  │
│                                                      │
│  4. 기존 시스템 활용 (Leverage Existing)             │
│     └── deployed_agents, chat_messages 확장          │
│                                                      │
└─────────────────────────────────────────────────────┘
```

### 19.2 Phase 1: 기반 스키마 (Week 1)

**목표**: 메모리/성장 시스템의 DB 기반 구축

```
┌─────────────────────────────────────────────────────┐
│  Phase 1: 기반 스키마                                │
├─────────────────────────────────────────────────────┤
│                                                      │
│  Step 1.1: 코어 테이블 생성                          │
│  ├── [ ] agent_identity (코어 자아)                  │
│  │   └── deployed_agents 확장, 성격/말투/가치관      │
│  ├── [ ] agent_stats (능력치)                        │
│  │   └── 분석력/소통력/창의성/리더십/전문성          │
│  └── 예상: 0.5일                                     │
│                                                      │
│  Step 1.2: 관계 테이블 생성                          │
│  ├── [ ] agent_relationships (관계)                  │
│  │   └── 친밀도/신뢰도/소통스타일/마일스톤           │
│  └── 예상: 0.5일                                     │
│                                                      │
│  Step 1.3: 메모리 테이블 생성                        │
│  ├── [ ] agent_memories (메모리)                     │
│  │   └── 5가지 타입, 임베딩, 요약, 중요도            │
│  ├── [ ] agent_learnings (학습 인사이트)             │
│  │   └── 카테고리/주제/인사이트/신뢰도               │
│  ├── [ ] agent_knowledge_base (주입 지식)            │
│  │   └── 문서/임베딩/접근레벨                        │
│  └── 예상: 1일                                       │
│                                                      │
│  Step 1.4: 마이그레이션 실행                         │
│  ├── [ ] Supabase migration 파일 생성                │
│  ├── [ ] npx supabase db push                        │
│  ├── [ ] TypeScript 타입 생성                        │
│  └── 예상: 0.5일                                     │
│                                                      │
│  의존성: 없음 (첫 단계)                              │
│  산출물: 6개 테이블 + 타입 정의                      │
│                                                      │
└─────────────────────────────────────────────────────┘
```

### 19.3 Phase 2: 메모리 시스템 (Week 1-2)

**목표**: 대화 → 메모리 저장 → 검색 파이프라인 구축

```
┌─────────────────────────────────────────────────────┐
│  Phase 2: 메모리 시스템                              │
├─────────────────────────────────────────────────────┤
│                                                      │
│  Step 2.1: 메모리 저장 서비스                        │
│  ├── [ ] lib/memory/memory-service.ts                │
│  │   ├── saveMemory() - 메모리 저장                  │
│  │   ├── getMemoryType() - 타입 결정 로직            │
│  │   └── checkAccessPermission() - 권한 체크         │
│  ├── [ ] 대화 종료 시 자동 저장 훅                   │
│  └── 예상: 1일                                       │
│                                                      │
│  Step 2.2: 메모리 압축 서비스                        │
│  ├── [ ] lib/memory/compression-service.ts           │
│  │   ├── compressMemories() - 요약 생성              │
│  │   ├── extractInsights() - 인사이트 추출           │
│  │   └── LLM 연동 (GPT-4o-mini)                     │
│  ├── [ ] 크론잡: 매일 오래된 메모리 압축             │
│  └── 예상: 1.5일                                     │
│                                                      │
│  Step 2.3: 메모리 검색 서비스                        │
│  ├── [ ] lib/memory/search-service.ts                │
│  │   ├── searchMemories() - 벡터 검색                │
│  │   ├── filterByPermission() - 권한 필터            │
│  │   └── rankByRelevance() - 관련성 정렬             │
│  ├── [ ] pgvector 인덱스 최적화                      │
│  └── 예상: 1일                                       │
│                                                      │
│  Step 2.4: 채팅 시스템 연동                          │
│  ├── [ ] 대화 시작 시 관련 메모리 로드               │
│  ├── [ ] 시스템 프롬프트에 메모리 컨텍스트 주입      │
│  ├── [ ] 대화 종료 시 메모리 자동 저장               │
│  └── 예상: 1일                                       │
│                                                      │
│  의존성: Phase 1 완료                                │
│  산출물: 메모리 CRUD + 검색 + 채팅 연동              │
│                                                      │
└─────────────────────────────────────────────────────┘
```

### 19.4 Phase 3: 관계 시스템 (Week 2)

**목표**: 에이전트-사용자 간 관계 추적 및 행동 조절

```
┌─────────────────────────────────────────────────────┐
│  Phase 3: 관계 시스템                                │
├─────────────────────────────────────────────────────┤
│                                                      │
│  Step 3.1: 관계 관리 서비스                          │
│  ├── [ ] lib/relationship/relationship-service.ts    │
│  │   ├── getOrCreateRelationship() - 관계 조회/생성  │
│  │   ├── updateRapport() - 친밀도 업데이트           │
│  │   ├── updateTrust() - 신뢰도 업데이트             │
│  │   └── recordMilestone() - 마일스톤 기록           │
│  └── 예상: 1일                                       │
│                                                      │
│  Step 3.2: 대화 스타일 조절                          │
│  ├── [ ] lib/relationship/style-adapter.ts           │
│  │   ├── getStyleForRelationship() - 스타일 결정     │
│  │   ├── adjustTone() - 톤 조절 (친근/격식)          │
│  │   └── 시스템 프롬프트 동적 생성                   │
│  └── 예상: 0.5일                                     │
│                                                      │
│  Step 3.3: 상호작용 후 관계 업데이트                 │
│  ├── [ ] 대화 종료 시 친밀도 계산                    │
│  │   ├── 대화 길이, 긍정/부정 감정, 피드백 반영      │
│  │   └── interaction_count 증가                      │
│  ├── [ ] 마일스톤 자동 감지                          │
│  │   └── 첫 대화, 10회 대화, 프로젝트 완료 등        │
│  └── 예상: 1일                                       │
│                                                      │
│  의존성: Phase 1 완료                                │
│  산출물: 관계 CRUD + 스타일 조절 + 자동 업데이트     │
│                                                      │
└─────────────────────────────────────────────────────┘
```

### 19.5 Phase 4: 성장 시스템 (Week 2-3)

**목표**: 경험 누적 → 능력치 성장 → 행동 변화

```
┌─────────────────────────────────────────────────────┐
│  Phase 4: 성장 시스템                                │
├─────────────────────────────────────────────────────┤
│                                                      │
│  Step 4.1: 능력치 관리 서비스                        │
│  ├── [ ] lib/growth/stats-service.ts                 │
│  │   ├── getStats() - 능력치 조회                    │
│  │   ├── updateStat() - 능력치 업데이트              │
│  │   └── calculateGrowth() - 성장량 계산             │
│  └── 예상: 0.5일                                     │
│                                                      │
│  Step 4.2: 경험 수집 엔진                            │
│  ├── [ ] lib/growth/experience-collector.ts          │
│  │   ├── 대화 경험 수집                              │
│  │   │   └── 대화 유형, 길이, 품질 분석              │
│  │   ├── 실행 경험 수집                              │
│  │   │   └── 워크플로우 성공/실패 기록               │
│  │   ├── 피드백 경험 수집                            │
│  │   │   └── 사용자 만족도 반영                      │
│  │   └── 업무 유형 → 능력치 매핑                    │
│  └── 예상: 1.5일                                     │
│                                                      │
│  Step 4.3: 성장 적용 엔진                            │
│  ├── [ ] lib/growth/growth-engine.ts                 │
│  │   ├── applyExperience() - 경험 → 능력치 변환      │
│  │   ├── checkLevelUp() - 레벨업 체크                │
│  │   └── updateExpertise() - 전문성 업데이트         │
│  ├── [ ] 성장 이벤트 로깅                            │
│  └── 예상: 1일                                       │
│                                                      │
│  Step 4.4: 능력치 기반 행동 조절                     │
│  ├── [ ] lib/growth/behavior-modifier.ts             │
│  │   ├── adjustResponse() - 응답 스타일 조절         │
│  │   ├── selectTools() - 선호 도구 선택              │
│  │   └── 능력치에 따른 프롬프트 조정                 │
│  └── 예상: 1일                                       │
│                                                      │
│  의존성: Phase 1, Phase 2, Phase 3                   │
│  산출물: 능력치 CRUD + 경험 수집 + 성장 적용         │
│                                                      │
└─────────────────────────────────────────────────────┘
```

### 19.6 Phase 5: 지식 주입 시스템 (Week 3)

**목표**: 에이전트 초기화 시 지식 베이스 주입

```
┌─────────────────────────────────────────────────────┐
│  Phase 5: 지식 주입 시스템                           │
├─────────────────────────────────────────────────────┤
│                                                      │
│  Step 5.1: 지식 업로드 서비스                        │
│  ├── [ ] lib/knowledge/upload-service.ts             │
│  │   ├── uploadDocument() - 문서 업로드              │
│  │   ├── parseDocument() - 문서 파싱 (PDF, MD, TXT)  │
│  │   ├── chunkDocument() - 청크 분할                 │
│  │   └── generateEmbeddings() - 임베딩 생성          │
│  └── 예상: 1.5일                                     │
│                                                      │
│  Step 5.2: 지식 검색 서비스                          │
│  ├── [ ] lib/knowledge/search-service.ts             │
│  │   ├── searchKnowledge() - 관련 지식 검색          │
│  │   └── 메모리 검색과 통합                          │
│  └── 예상: 0.5일                                     │
│                                                      │
│  Step 5.3: 에이전트 빌더 연동                        │
│  ├── [ ] 에이전트 생성 시 지식 업로드 UI             │
│  ├── [ ] 지식 목록 관리 UI                           │
│  └── 예상: 1일                                       │
│                                                      │
│  의존성: Phase 1                                     │
│  산출물: 지식 업로드 + 검색 + UI                     │
│                                                      │
└─────────────────────────────────────────────────────┘
```

### 19.7 Phase 6: API 레이어 (Week 3)

**목표**: 프론트엔드 연동을 위한 API 엔드포인트 구축

```
┌─────────────────────────────────────────────────────┐
│  Phase 6: API 레이어                                 │
├─────────────────────────────────────────────────────┤
│                                                      │
│  Step 6.1: Identity & Stats API                      │
│  ├── [ ] GET  /api/agents/:id/identity               │
│  ├── [ ] PATCH /api/agents/:id/identity              │
│  ├── [ ] GET  /api/agents/:id/stats                  │
│  └── 예상: 0.5일                                     │
│                                                      │
│  Step 6.2: Relationships API                         │
│  ├── [ ] GET  /api/agents/:id/relationships          │
│  ├── [ ] GET  /api/agents/:id/relationships/:partnerId│
│  ├── [ ] PATCH /api/agents/:id/relationships/:partnerId│
│  └── 예상: 0.5일                                     │
│                                                      │
│  Step 6.3: Memories API                              │
│  ├── [ ] GET  /api/agents/:id/memories               │
│  ├── [ ] GET  /api/agents/:id/memories/search        │
│  ├── [ ] GET  /api/agents/:id/memories/graph         │
│  ├── [ ] POST /api/agents/:id/memories               │
│  └── 예상: 1일                                       │
│                                                      │
│  Step 6.4: Knowledge API                             │
│  ├── [ ] GET  /api/agents/:id/knowledge              │
│  ├── [ ] POST /api/agents/:id/knowledge              │
│  ├── [ ] DELETE /api/agents/:id/knowledge/:docId     │
│  └── 예상: 0.5일                                     │
│                                                      │
│  의존성: Phase 2, 3, 4, 5                            │
│  산출물: 12+ API 엔드포인트                          │
│                                                      │
└─────────────────────────────────────────────────────┘
```

### 19.8 Phase 7: 프로필 UI (Week 4)

**목표**: 에이전트 프로필 페이지 (능력치 + 3D 그래프)

```
┌─────────────────────────────────────────────────────┐
│  Phase 7: 프로필 UI                                  │
├─────────────────────────────────────────────────────┤
│                                                      │
│  Step 7.1: 프로필 기본 UI                            │
│  ├── [ ] components/agent/AgentProfile.tsx           │
│  │   ├── 에이전트 정보 (이름, 역할, Day 수)          │
│  │   ├── 신뢰도/성공률/평균시간/총비용               │
│  │   └── 최근 성과 목록                              │
│  └── 예상: 1일                                       │
│                                                      │
│  Step 7.2: 능력치 레이더 차트                        │
│  ├── [ ] components/agent/StatsRadar.tsx             │
│  │   ├── 5종 능력치 레이더 차트                      │
│  │   ├── 도메인 전문성 탭                            │
│  │   └── 30일 변화량 오버레이                        │
│  ├── [ ] recharts 또는 chart.js 사용                 │
│  └── 예상: 1일                                       │
│                                                      │
│  Step 7.3: 3D 지식 그래프                            │
│  ├── [ ] components/agent/KnowledgeGraph3D.tsx       │
│  │   ├── react-force-graph-3d 설치                   │
│  │   ├── 노드/엣지 렌더링                            │
│  │   ├── 노드 클릭 → 상세 패널                       │
│  │   └── 필터 (기간/타입/프로젝트/중요도)            │
│  ├── [ ] 그래프 데이터 API 연동                      │
│  └── 예상: 2일                                       │
│                                                      │
│  Step 7.4: 프로필 페이지 통합                        │
│  ├── [ ] app/dashboard-group/agents/[id]/profile/page.tsx│
│  │   ├── 탭 구성: 개요 / 능력치 / 뇌 그래프 / 관계  │
│  │   └── 반응형 레이아웃                             │
│  └── 예상: 1일                                       │
│                                                      │
│  의존성: Phase 6                                     │
│  산출물: 에이전트 프로필 페이지                      │
│                                                      │
└─────────────────────────────────────────────────────┘
```

### 19.9 전체 일정 요약

```
┌─────────────────────────────────────────────────────┐
│                   4주 구현 일정                      │
├─────────────────────────────────────────────────────┤
│                                                      │
│  Week 1 (Day 1-5)                                    │
│  ├── Phase 1: 기반 스키마 (2.5일)                    │
│  └── Phase 2: 메모리 시스템 시작 (2.5일)             │
│                                                      │
│  Week 2 (Day 6-10)                                   │
│  ├── Phase 2: 메모리 시스템 완료 (2일)               │
│  ├── Phase 3: 관계 시스템 (2.5일)                    │
│  └── Phase 4: 성장 시스템 시작 (0.5일)               │
│                                                      │
│  Week 3 (Day 11-15)                                  │
│  ├── Phase 4: 성장 시스템 완료 (3.5일)               │
│  ├── Phase 5: 지식 주입 시스템 (3일)                 │
│  └── Phase 6: API 레이어 시작 (0.5일)                │
│                                                      │
│  Week 4 (Day 16-20)                                  │
│  ├── Phase 6: API 레이어 완료 (2일)                  │
│  └── Phase 7: 프로필 UI (5일)                        │
│                                                      │
│  총 예상: 20일 (4주)                                 │
│                                                      │
└─────────────────────────────────────────────────────┘
```

### 19.10 의존성 다이어그램

```
Phase 1: 기반 스키마
    │
    ├──────────────┬──────────────┬──────────────┐
    ▼              ▼              ▼              ▼
Phase 2       Phase 3       Phase 4       Phase 5
메모리        관계          성장          지식주입
    │              │              │              │
    └──────────────┴──────────────┴──────────────┘
                        │
                        ▼
                   Phase 6
                   API 레이어
                        │
                        ▼
                   Phase 7
                   프로필 UI
```

### 19.11 시작 체크리스트

```
┌─────────────────────────────────────────────────────┐
│  Phase 1 시작 전 확인사항                            │
├─────────────────────────────────────────────────────┤
│                                                      │
│  [ ] Supabase 프로젝트 접근 확인                     │
│  [ ] pgvector 확장 활성화 확인                       │
│  [ ] 기존 테이블 스키마 검토                         │
│      ├── deployed_agents                             │
│      ├── chat_messages                               │
│      ├── chat_rooms                                  │
│      └── chat_participants                           │
│  [ ] 마이그레이션 폴더 구조 확인                     │
│  [ ] TypeScript 타입 생성 명령어 확인                │
│                                                      │
└─────────────────────────────────────────────────────┘
```

---

*문서 버전: 2.0*
*작성일: 2024-12-19*
*작성자: Claude + GPT + 진수*
